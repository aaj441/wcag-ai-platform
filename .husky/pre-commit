#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ”’ Running pre-commit security checks..."
echo ""

# Check for secrets
echo "ğŸ” Checking for secrets..."
git-secrets --pre_commit_hook || {
  echo "âŒ Secret detection failed! Found potential secrets in staged files."
  echo "   Run: git secrets --install -f"
  exit 1
}
echo "âœ… No secrets detected"
echo ""

# Run ESLint
echo "ğŸ” Running ESLint..."
npx eslint --fix . --max-warnings 5 || {
  echo "âš ï¸  ESLint found issues (auto-fixed where possible)"
  echo "   Please review the changes and commit again if needed"
}
echo "âœ… ESLint check complete"
echo ""

# Run Prettier
echo "ğŸ” Formatting code..."
npx prettier --write . || true
echo "âœ… Code formatting complete"
echo ""

# Add any formatted files
git add -A

echo "âœ… Pre-commit checks passed!"
